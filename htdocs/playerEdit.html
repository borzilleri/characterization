<?php
$form_key = 'player_edit_'.(empty($_REQUEST['id'])?0:$_REQUEST['id']);
$css_include = array('forms.css');
include('autohandler.php');

if( 'add' == $action ) {
  $char = new Player;
}
?>
<? if( 'delete' == $action ): ?>
<form method="post" action="<?=SITE_URL;?>/delete">
<div class="formColumn leftColumn">
  <div class="formRow">
    <label>Confirm Delete For:</label>
    <div class="field">
      <?=$char->name;?>, 
      <?=$char->Race->name;?>
      <?=$char->Archetype->name;?> <?=$char->level;?>
    </div>
  </div>
  <div class="formRow">
    <label>&nbsp;</label>
    <div class="field">
      <input type="hidden" name="id" value="<?=$char->id;?>" />
      <input type="submit" value="Delete" />
    </div>
  </div>
</div>
</form>
<? else: ?>

<form method="post" action="<?=SITE_URL;?>/save">
<div class="formColumn leftColumn">
  <div class="formRow">
    <label for="character_name">Name:</label>
    <div class="field">
      <input type="text" class="text" size="20" maxlength="255"
        id="character_name" name="character_name"
        value="<?=$char->getCached('name',$form_key);?>" />
    </div>
  </div>
  
  <div class="formRow">
    <label for="race">Race:</label>
    <div class="field">
      <?=Race::generateSelect(
        'race', 'race', $char->getCached('race_id', $form_key));?>
    </div>
  </div>
  
  <div class="formRow">
    <label for="archetype">Class:</label>
    <div class="field">
      <?=Archetype::generateSelect(
        'archetype', 'archetype', $char->getCached('archetype_id',$form_key));?>
    </div>
  </div>
  
  <div class="formRow">
    <label for="level"
      class="<?=$char->hasError('level',$form_key)?'error':'';?>">Level:</label>
    <div class="field">
      <select name="level" id="level">
      <? for($i=1;$i<=30;$i++): ?>
        <option value="<?=$i;?>" <?=$i==$char->getCached('level',$form_key)?
            'selected="selected"':'';?>><?=$i;?></option>
      <? endfor; ?>
      </select>
    </div>
  </div>
  
  <div class="formRow">
    <label for="attack_general"
      class="<?=$char->hasError('attack_general',$form_key)?'error':'';?>"
      >General Atk Bonus: <span class="help" title="General Attack Bonus: Any bonuses that would apply to ALL your attacks should be set here. (DO NOT count level or ability bonuses.)">?</span>
    </label>
    <div class="field">
      <input type="text" size="3" maxlength="3" 
        id="attack_general" name="attack_general"
        value="<?=$char->getCached('attack_general',$form_key);?>" />
    </div>
  </div>

  <div class="formRow">
    <label for="attack_implement"
      class="<?=$char->hasError('attack_implement',$form_key)?'error':'';?>"
      >Implement Atk Bonus: <span class="help" title="Implement Attack Bonus: Any bonuses that apply to your Implmenet powers (from a magic implement, feat, etc) should be set here.">?</span>
    </label>
    <div class="field">
      <input type="text" size="3" maxlength="3"
        id="attack_implement" name="attack_implement"
        value="<?=$char->getCached('attack_implement', $form_key);?>" />
    </div>
  </div>

  <div class="formRow">
    <label for="attack_weapon_main">Weapon Atk Bonus:
      <span class="help" title="Weapon Attack Bonus: Any bonuses that apply to your Weapon powers (from a magic weapon, feat, etc) should be set here. You may set main hand and off hand bonuses separately.">?</span>
    </label>
    <div class="field">
      <label for="attack_weapon_main"
        class="<?=$char->hasError('attack_weapon_main',$form_key)?'error':'';?>"
        >Main:</label>
      <input type="text" size="3" maxlength="3"
        id="attack_weapon_main" name="attack_weapon_main"
        value="<?=$char->getCached('attack_weapon_main',$form_key);?>" />&nbsp;/
      <label for="attack_weapon_off"
        class="<?=$char->hasError('attack_weapon_off',$form_key)?'error':'';?>"
        >Off:</label>
      <input type="text" size="3" maxlength="3"
        id="attack_weapon_off" name="attack_weapon_off"
        value="<?=$char->getCached('attack_weapon_off', $form_key);?>" />
    </div>
  </div>

  <div class="formRow optional">
    <label for="health_bonus"
      class="<?=$char->hasError('health_bonus',$form_key)?'error':'';?>"
      >Bonus Health: <span class="help" title="Bonus Health: Optional. If you have an ability that grants additional health (e.g. Toughness), enter the total extra health you get here.">?</span>
    </label>
    <div class="field">
      <input type="text" size="5" maxlength="4" 
        id="health_bonus" name="health_bonus" 
        value="<?=$char->getCached('health_bonus', $form_key);?>" />
    </div>
  </div>

</div><!-- end div.leftColumn -->

<div class="formColumn rightColumn">
  <div class="formRow">
    <label for="strength"
      class="<?=$char->hasError('strength',$form_key)?'error':'';?>"
      >Strength:</label>
    <div class="field">
      <input type="text" id="strength" name="strength" size="3" maxlength="2" 
        value="<?=$char->getCached('strength', $form_key);?>" />
    </div>
  </div>
  <div class="formRow">
    <label for="constitution"
      class="<?=$char->hasError('constitution',$form_key)?'error':'';?>"
      >Constitution:</label>
    <div class="field">
      <input type="text" id="constitution" name="constitution" 
        size="3" maxlength="2" 
        value="<?=$char->getCached('constitution', $form_key);?>" />
    </div>
  </div>
  <div class="formRow">
    <label for="dexterity"
      class="<?=$char->hasError('dexterity',$form_key)?'error':'';?>"
      >Dexterity:</label>
    <div class="field">
      <input type="text" id="dexterity" name="dexterity" size="3" maxlength="2"
        value="<?=$char->getCached('dexterity', $form_key);?>" />
    </div>
  </div>
  <div class="formRow">
    <label for="intelligence"
      class="<?=$char->hasError('intelligence',$form_key)?'error':'';?>"
      >Intelligence:</label>
    <div class="field">
      <input type="text" id="intelligence" name="intelligence"
        size="3" maxlength="2" 
        value="<?=$char->getCached('intelligence', $form_key);?>" />
    </div>
  </div>
  <div class="formRow">
    <label for="wisdom"
      class="<?=$char->hasError('wisdom',$form_key)?'error':'';?>"
      >Wisdom:</label>
    <div class="field">
      <input type="text" id="wisdom" name="wisdom" size="3" maxlength="2" 
        value="<?=$char->getCached('wisdom', $form_key);?>" />
    </div>
  </div>
  <div class="formRow">
    <label for="charisma"
      class="<?=$char->hasError('charisma',$form_key)?'error':'';?>"
      >Charisma:</label>
    <div class="field">
      <input type="text" id="charisma" name="charisma" size="3" maxlength="2" 
        value="<?=$char->getCached('charisma', $form_key);?>" />
    </div>
  </div>
  
  <div class="formRow optional">
    <label for="surges_bonus"
      class="<?=$char->hasError('surges_bonus',$form_key)?'error':'';?>"
      >Bonus Surges: <span class="help" title="Bonus Surges: Optional. If you have an ability that grants additional surges, enter the total extra surges you have here.">?</span>
    </label>
    <div class="field">
      <input type="text" id="surges_bonus" name="surges_bonus"
        size="4" maxlength="3" 
        value="<?=$char->getCached('surges_bonus', $form_key);?>" />
    </div>
  </div>

  <div class="formRow optional">
    <label for="surge_value_bonus"
      class="<?=$char->hasError('surge_value_bonus',$form_key)?'error':'';?>"
      >Bonus Surge Value: <span class="help" title="Bonus Surge Value: Optional. If you have an ability that grants bonus surge value (e.g. Draconic Heritage), enter the extra surge value you get here.">?</span>
    </label>
    <div class="field">
      <input type="text" id="surge_value_bonus" name="surge_value_bonus"
        size="4" maxlength="3" 
        value="<?=$char->getCached('surge_value_bonus', $form_key);?>" />
    </div>
  </div>
</div><!-- end div.rightColumn -->

<div id="SubmitButton" class="clear">
  <input type="hidden" name="form_key" value="<?=$form_key;?>" />
  <? if( $char->exists() ): ?>
  <input type="hidden" name="id" value="<?=$char->id;?>" />
  <? endif; ?>
  <input type="submit" value="Submit" />
</div>
</form>
<? endif; ?>

<?php include('footer.php'); ?>
