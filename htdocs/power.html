<?php
$css_include = array('powerBox.css');
$js_include = array('power.js');
include('autohandler.php');

if( !$char || !$char->exists() ) {
  loadPage('/');
}

$power_list = Doctrine_Query::create()
  ->from('Power p')
  ->where('p.player_id = ?', $char->id)
  ->orderBy('p.use_type, p.level, p.name')
  ->execute();

$i = 0;
?>
<div id="PowerList">
  <ul class="list">
    <li class="row<?=$i;$i=($i+1)%2;?>">
      <div class="listLinks">
        [<a href="<?=SITE_URL;?>/<?=$char->id;?>/power/new">new power</a>]
      </div>
		<? if( $power_list->count() > 1 ): ?>
      <div class="listLabel">
        [ <a href="#" class="sort asc" id="power_name">Power Name</a>
        <span id="name_arr"></span> ]
      </div>
      <div class="listInfo">
        [ <a href="#" class="sort asc" id="level">Level</a>
        <span id="level_arr"></span> ]
        [ <a href="#" class="sort desc" id="use_type">Usage</a>
        <span id="usage_arr">&uarr;</span> ]
      </div>
		<? endif; ?>
    </li>
  <? foreach($power_list as $p): ?>
    <li class="powerItem row<?=$i;$i=($i+1)%2;?>">
      <div class="listLinks">
        [ <a href="#" id="l<?=$p->id;?>" class="power_preview"
					>view</a>&nbsp;|
        <a href="<?=SITE_URL;?>/<?=$char->id;?>/power/<?=$p->id;?>/edit"
					>edit</a> ]
      </div>
      <div class="listLabel">
        <span class="power_name"><?=$p->name;?></span>
      </div>
      <div class="listInfo">
        <span class="<?=$p->getUseTypeDisplay();?>">
          Level <span class="level"><?=$p->level;?></span>
          <span class="use_type"><?=$p->getUseTypeDisplay();?></span>
        </span>
      </div>
    </li>
  <? endforeach; ?>
  </ul>
</div><!-- end div#PowerList -->

<div id="PowerPreview"></div>

<?php include('footer.php');?>
