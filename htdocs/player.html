<?php
$css_include = array('statBlock.css', 'powerBox.css');
$js_include = array('playerProcess.js');
include('autohandler.php');

if( !$char ) {
  loadPage('/');
}

$power_list = Doctrine_Query::create()
  ->from('Power p')
  ->where('p.player_id = ?', $char->id)
  ->orderBy('p.item, p.use_type, p.level')
  ->execute();
?>
<div id="StatBlock">
  <div class="leftColumn contentColumn">
    <div class="statRow">
      <label class="statLabel" for="player_health">Health:</label>
      <div class="statInfo" id="player_health">
        <span class="<?=$char->getStatusText();?>" id="health_cur">
          <?=$char->health_cur;?></span>
        &nbsp;/&nbsp;
        <span id="health_max"><?=$char->health_max;?></span>
        <span id="health_tmp"><?=($char->health_tmp?
          "({$char->health_tmp})":'');?></span>
        <span id="health_status" class="<?=$char->getStatusText();?>">
          <?=($char->getStatusText()?"({$char->getStatusText()})":'');?></span>
      </div>
    </div>
    
    <div class="statRow">
      <label class="statLabel" for="player_surges">Surges:</label>
      <div class="statInfo" id="player_surges">
        <span id="surges_cur"><?=$char->surges_cur;?></span>
        &nbsp;/&nbsp;
        <span id="surges_max"><?=$char->surges_max;?></span>
        (<span id="surge_value"><?=$char->surge_value;?></span>)
        <a href="#" id="surgePlus" class="ajaxLink">add</a>&nbsp;/
        <a href="#" id="surgeMinus" class="ajaxLink">remove</a>        
      </div>
    </div>
    <div class="statRow">
      <label class="statLabel" for="player_apoints">AP:</label>
      <div class="statInfo" id="player_apoints">
        <span id="action_points"><?=$char->action_points;?></span>
        <a href="#" id="apPlus" class="ajaxLink">add</a>&nbsp;/
        <a href="#" id="apMinus" class="ajaxLink">remove</a>
      </div>
    </div>

    <div class="statRow">
      <label class="statLabel" for="player_mi_uses">Item Uses:</label>
      <div class="statInfo" id="player_mi_uses">
        <span id="magic_item_uses"><?=$char->magic_item_uses;?></span>
        <a href="#" id="miPlus" class="ajaxLink">add</a>&nbsp;/
        <a href="#" id="miMinus" class="ajaxLink">remove</a>
      </div>
    </div>

    <div class="statRow">
      <label class="statLabel" for="player_rest">Rest:</label>
      <div class="statInfo" id="player_rest">
        <a href="#" id="shortRest" class="ajaxLink">short</a>&nbsp;/
        <a href="#" id="extendedRest" class="ajaxLink">extended</a>
      </div>
    </div>
  </div><!-- end div.leftColumn -->
  
  <div class="rightColumn contentColumn">
    <div class="statRow">
      <label class="statLabel">Damage:</label>
      <div class="statInfo">
        <input type="text" id="damage_value" value="" size="3" maxlength="3" />
        <a href="#" id="takeDamage" class="ajaxLink">Damage</a>
      </div>
    </div>
    <div class="statRow">
      <label class="statLabel">Surges:</label>
      <div class="statInfo">
        <input type="text" id="surge_bonus" size="3" maxlength="3" value="" />
        <a href="#" id="spendSurge" class="ajaxLink">Use Surge</a>
      </div>
    </div>
    <div class="statRow">
      <label class="statLabel">Temp Health:</label>
      <div class="statInfo">
        <input type="text" id="health" value="" size="3" maxlength="3" />
        <a href="#" id="tempHealth" class="ajaxLink">Temp Health</a>
      </div>
    </div>
  </div><!-- end div.rightColumn -->
</div><!-- end div#StatBlock -->

<hr class="clear" />
<div id="PlayerPowers" class="powerColumn rightColumn">
  <table id="PowerTable">
    <tbody>
    <? foreach($power_list as $p): ?>
      <tr id="r<?=$p->id;?>" class="powerRow 
        <?=$p->getUseTypeDisplay(true);?> <?=$p->getUsageStatus();?>">
        <td>
        <? if(!$p->isUseType(Power::POWER_ATWILL)): ?>
            <img class="power_icon" title="stuff" id="u<?=$p->id;?>"
              src="<?=MEDIA_URL.$p->getUsageIcon();?>" />
        <? endif; ?>
        </td>
        <td class="powerName"><?=$p->name;?></td>
        <td class="powerClass"><?=$p->getClassDisplay();?> <?=$p->level;?></td>
        <td>
          <img id="v<?=$p->id;?>" class="power_view" title="View <?=$p->name;?>"
            src="<?=MEDIA_URL;?>/images/icon_view.png"/>
        </td>
      </tr>
    <? endforeach; ?>
    </tbody>
  </table>
</div>

<div id="PlayerNotes" class="notesColumn contentColumn">
  <div>
    <span id="notes_dirty" 
      title="Unsaved changes, click 'save notes' to save">*</span>
    <a href="#" id="updateNotes" class="ajaxLink">save notes</a>
  </div>
  <textarea name="notes" id="player_notes" 
    cols="25" rows="5"><?=$char->notes;?></textarea>
</div>

<?php include('footer.php'); ?>
