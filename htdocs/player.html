<?php
$css_include = array('statBlock.css', 'powerBox.css');
$js_include = array('playerProcess.js');
include('autohandler.php');

if( !$char ) {
  loadPage('/');
}

$power_list = Doctrine_Query::create()
  ->from('Power p')
  ->where('p.player_id = ?', $char->id)
  ->orderBy('p.use_type, p.level')
  ->execute();
?>
<script type="text/javascript" charset="utf-8">
  var CHAR_ID = <?=$char->id;?>;
</script>

<div id="StatBlock">
  <div class="leftColumn contentColumn">
    <div class="statRow">
      <label class="statLabel" for="player_health">Health:</label>
      <div class="statInfo" id="player_health">
        <span class="<?=$char->getStatusText();?>" id="health_cur">
          <?=$char->health_cur;?></span>
        &nbsp;/&nbsp;
        <span id="health_max"><?=$char->health_max;?></span>
        <span id="health_tmp"><?=($char->health_tmp?
          "({$char->health_tmp})":'');?></span>
        <span id="health_status" class="<?=$char->getStatusText();?>">
          <?=($char->getStatusText()?"({$char->getStatusText()})":'');?></span>
      </div>
    </div>
    
    <div class="statRow">
      <label class="statLabel" for="player_surges">Surges:</label>
      <div class="statInfo" id="player_surges">
        <span id="surges_cur"><?=$char->surges_cur;?></span>
        &nbsp;/&nbsp;
        <span id="surges_max"><?=$char->surges_max;?></span>
        (<span id="surge_value"><?=$char->surge_value;?></span>)
        <a href="#" id="surgePlus">add</a>&nbsp;/
        <a href="#" id="surgeMinus">remove</a>        
      </div>
    </div>
    <div class="statRow">
      <label class="statLabel" for="player_apoints">AP:</label>
      <div class="statInfo" id="player_apoints">
        <span id="action_points"><?=$char->action_points;?></span>
        <a href="#" id="apPlus">add</a>&nbsp;/
        <a href="#" id="apMinus">remove</a>
      </div>
    </div>
    <div class="statRow">
      <label class="statLabel" for="player_rest">Rest:</label>
      <div class="statInfo" id="player_rest">
        <a href="#" id="shortRest">short</a>&nbsp;/
        <a href="#" id="extendedRest">extended</a>
      </div>
    </div>
  </div><!-- end div.leftColumn -->
  
  <div class="rightColumn contentColumn">
    <div class="statRow">
      <label class="statLabel">Damage:</label>
      <div class="statInfo">
        <input type="text" id="damage_value" value="0" size="3" maxlength="3" />
        <a href="#" id="takeDamage">Damage</a>
      </div>
    </div>
    <div class="statRow">
      <label class="statLabel">Surges:</label>
      <div class="statInfo">
        <input type="text" id="surge_bonus" size="3" maxlength="3" value="0" />
        <a href="#" id="spendSurge">Use Surge</a>
      </div>
    </div>
    <div class="statRow">
      <label class="statLabel">Temp Health:</label>
      <div class="statInfo">
        <input type="text" id="health" value="0" size="3" maxlength="3" />
        <a href="#" id="tempHealth">TmpHealth</a>
      </div>
    </div>
  </div><!-- end div.rightColumn -->
</div><!-- end div#StatBlock -->

<hr class="clear" />

<div id="powerLeft" class="leftColumn contentColumn"><? $i = 0; 
  foreach($power_list as $power): $i = ($i+1)%2;
    if( $i ) echo $power->getPowerBox();
  endforeach; ?>
</div>

<div id="powerRight" class="rightColumn contentColumn"><? $i = 1;
  foreach($power_list as $power): $i = ($i+1)%2;
    if( $i ) echo $power->getPowerBox();
  endforeach; ?>
</div>

<div id="PlayerNotes" class="notesColumn contentColumn">
  <div>
    <span id="notes_dirty">unsaved</span>
    <a href="#" id="updateNotes">update notes</a>
  </div>
  <textarea name="notes" id="player_notes" 
    cols="25" rows="5"><?=$char->notes;?></textarea>
</div>

<?php include('footer.php'); ?>
